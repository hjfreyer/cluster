#cloud-config

coreos:
  units:
    - name: data.mount
      command: start
      content: |
        [Mount]
        What=/dev/disk/by-uuid/e26e2f5d-50c7-4932-90d5-05e9477f2be0
        Where=/data/
        Type=ext4

    - name: kubelet.service
      command: start
      enable: true
      content: |
        [Unit]
        Description=Kubernetes Kubelet
        Documentation=https://github.com/kubernetes/kubernetes

        [Service]
        ExecStartPre=/usr/bin/mkdir -p /etc/kubernetes/manifests
        ExecStart=/usr/bin/kubelet \
          --api-servers=http://127.0.0.1:8080 \
          --allow-privileged=true \
          --config=/etc/kubernetes/manifests \
          --v=2
        Restart=on-failure
        RestartSec=5

        [Install]
        WantedBy=multi-user.target
